<!DOCTYPE html>
<html>

<head>
    <title>Nebula-M78</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="/style.css" type="text/css">
    <style>
    </style>
    <script>
        window.requestJSON = function (url, success, failed) {
            var xh = new XMLHttpRequest()
            xh.onreadystatechange = function () {
                if (xh.readyState === XMLHttpRequest.DONE) {
                    if (xh.status === 200) {
                        success(JSON.parse(xh.responseText))
                    } else if (failed) {
                        failed(xh)
                    }
                }
            }
            xh.open('GET', url)
            xh.send(null)
        }
    </script>
</head>

<body>
    <div id="banner">
        <h1><a href="/">Nebula-M78</a></h1>
    </div>
    <li class="template temp-thread">
        <h3 class="thread-title"><a href="{{path}}">{{title}}</a></h3>
        <span>{{abstract}}</span>
        <div class="thread-bar"><span>修改时间：{{mtime}}</span> <span><a href="{{path}}">阅读</a></span></div>
        <hr>
    </li>
    <ol id="threads-container"></ol>
    <div id="pagination"><a href="#1">上一页</a><a href="#2">下一页</a></div>
    <div id="footer">
        <div id="footer-list">
            <a href="http://github.com/LaoQi/nebula-m78">关于本站</a> | 一些有趣的东西: <a href="http://github.com/LaoQi/tccgi" title="用来学习http服务器的一个简单C语言实现">Tccgi</a> | 
            <a href="/game/nebulaJS/" title="小型的JS游戏框架">nebulaJS</a>
        </div>
    </div>
    <script>
        function render(index) {
            var container = document.getElementById('threads-container')
            container.innerHTML = ''
            requestJSON('/index.' + index + '.json', function (data) {
                var template = document.getElementsByClassName('temp-thread')[0]
                for (var i in data) {
                    var li = template.cloneNode(true)
                    li.className = "thread"
                    var text = li.innerHTML
                    li.innerHTML = text.replace(/{{(.*?)}}/g, function (a, b) {
                        if (b == 'mtime') {
                            return new Date(parseInt(data[i][b]) * 1000).toLocaleString()
                        }
                        return data[i][b]
                    })
                    container.appendChild(li)
                }
                var pagination = document.getElementById('pagination')
                if (index > 0) {
                    pagination.innerHTML = '<a href="#' + (index - 1) + '">上一页</a><a href="#' + (index + 1) + '">下一页</a>'
                } else {
                    pagination.innerHTML = '<a href="#' + (index + 1) + '">下一页</a>'
                }
                document.documentElement.scrollTop = document.body.scrollTop = 0
            }, function (e) {
                var container = document.getElementById('threads-container')
                container.innerHTML = '<h2>找不到内容，<a href="javascript:window.history.back()">返回上一页</a></h2>'
                var pagination = document.getElementById('pagination')
                pagination.innerHTML = ''
            })
        }

        window.onhashchange = function () {
            var index = parseInt(location.hash.substring(1))
            if (index > 0) {
                render(index)
            } else {
                render(0)
            }
        }

        window.onhashchange()
    </script>
</body>

</html>